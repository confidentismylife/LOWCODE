import{bh as A,bi as V,bj as ae,r as u,bk as R,bl as e,R as T,bm as Z,bn as le,bo as ee,bp as te,bq as L,br as H,bs as D,bt as ce,bu as z,bv as ie,bw as de,bx as pe,by as ue,bz as me}from"./vendor-pBK94go_.js";import{a as fe,d as he}from"./lodash-D7EwgX3d.js";import{B as k,M as O,F as ne,a as w,I as N,D as xe,s as P,L as $,b as ge,S as oe,c as be,P as ye,d as B,T as je,e as ve,f as U,C as Ce,g as Se,h as we}from"./antd-CdLVY5OA.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))s(l);new MutationObserver(l=>{for(const r of l)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(l){const r={};return l.integrity&&(r.integrity=l.integrity),l.referrerPolicy&&(r.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?r.credentials="include":l.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(l){if(l.ep)return;l.ep=!0;const r=t(l);fetch(l.href,r)}})();const se=A()(V(o=>({componentShow:[],addShowMessage:n=>o(t=>{console.log("newComponent",n),console.log("state",t);const s=fe(n);return{componentShow:[...t.componentShow,s]}})}),{name:"components-show-storage"})),Me=(o,n)=>({components:[{id:1,name:"Page",props:{},desc:"页面"}],curComponentId:null,curComponent:null,mode:"edit",setMode:t=>o({mode:t}),setCurComponentId:t=>o(s=>({curComponentId:t,curComponent:M(t,s.components)})),addComponent:(t,s)=>o(l=>{if(s){const r=M(s,l.components);return r&&(r.children?r.children.push(t):r.children=[t]),t.parentId=s,{components:[...l.components]}}return{components:[...l.components,t]}}),deleteComponent:t=>{var l;if(!t)return;const s=M(t,n().components);if(s!=null&&s.parentId){const r=M(s.parentId,n().components);r&&(r.children=(l=r==null?void 0:r.children)==null?void 0:l.filter(a=>a.id!==+t),o({components:[...n().components]}))}},updateComponentProps:(t,s)=>o(l=>{const r=M(t,l.components);return r?(r.props={...r.props,...s},{components:[...l.components]}):{components:[...l.components]}}),updateComponentStyles:(t,s,l)=>o(r=>{const a=M(t,r.components);return a?(a.styles=l?{...s}:{...a.styles,...s},{components:[...r.components]}):{components:[...r.components]}})}),S=A()(V(Me,{name:"xxx"}));function M(o,n){if(!o)return null;for(const t of n){if(t.id==o)return t;if(t.children&&t.children.length>0){const s=M(o,t.children);if(s!==null)return s}}return null}function F(o,n){const{addComponent:t,deleteComponent:s,components:l}=S(),{componentConfig:r}=I(),[{canDrop:a},c]=ae(()=>({accept:o,drop:(i,d)=>{if(!d.didDrop())if(i.dragType==="move"){const p=M(i.id,l);s(i.id),t(p,n)}else{const p=r[i.type];t({id:new Date().getTime(),name:i.type,desc:p.desc,props:p.defaultProps},n)}},collect:i=>({canDrop:i.canDrop()})}));return{canDrop:a,drop:c}}const J=A()(V(o=>({components:["Button","Container","Table","Form","Yuancheng","Modal"],addComponentDrop:n=>o(t=>({components:[...t.components,n]}))}),{name:"components-drop-storage"})),Ne=({id:o,name:n,children:t,styles:s})=>{const{components:l}=J(),{canDrop:r,drop:a}=F([...l],o),c=u.useRef(null),[i,d]=R({type:n,item:{type:n,dragType:"move",id:o}});return u.useEffect(()=>{a(c),d(c)},[]),e.jsx("div",{"data-component-id":o,ref:c,style:s,className:`min-h-[100px] p-[20px] ${r?"border-[2px] border-[blue]":"border-[1px] border-[#000]"}`,children:t})},Ie=({id:o,children:n,styles:t})=>(console.log("Container",o,t),e.jsx("div",{style:t,className:"p-[20px]",children:n})),ke=({id:o,type:n,text:t,styles:s})=>{const[l,r]=R({type:"Button",item:{type:"Button",dragType:"move",id:o}});return console.log(l),e.jsx(k,{ref:r,"data-component-id":o,type:n,style:s,children:t})},Te=({id:o,type:n,text:t,styles:s,...l})=>(console.log(o),e.jsx(k,{type:n,style:s,...l,children:t}));function Ee({id:o,name:n,children:t,styles:s}){const{components:l}=J(),{canDrop:r,drop:a}=F([...l],o);return console.log("Page",o,n,t,s),e.jsx("div",{"data-component-id":o,ref:a,className:"p-[20px] h-[100%] box-border",style:{...s,border:r?"2px solid blue":"none"},children:t})}function Pe({id:o,name:n,children:t,styles:s}){return console.log("Page",o,s,n),e.jsx("div",{className:"p-[20px]",style:{...s},children:t})}const Le=({children:o,title:n,onOk:t,onCancel:s,styles:l},r)=>{const[a,c]=u.useState(!1);return u.useImperativeHandle(r,()=>({open:()=>c(!0),close:()=>c(!1)}),[]),e.jsx(O,{title:n,style:l,open:a,onCancel:()=>{s&&s(),c(!1)},onOk:()=>{t&&t()},destroyOnClose:!0,children:o})},Re=u.forwardRef(Le);function Fe({id:o,children:n,title:t,styles:s}){const{components:l}=J(),{canDrop:r,drop:a}=F([...l],o);return e.jsxs("div",{ref:a,style:s,"data-component-id":o,className:`min-h-[100px] p-[20px] ${r?"border-[2px] border-[blue]":"border-[1px] border-[#000]"}`,children:[e.jsx("h4",{children:t}),e.jsx("div",{children:n})]})}function De({id:o,name:n,children:t,styles:s}){const{canDrop:l,drop:r}=F(["TableColumn"],o),a=u.useRef(null),[c,i]=R({type:n,item:{type:n,dragType:"move",id:o}});u.useEffect(()=>{r(a),i(a)},[]);const d=u.useMemo(()=>T.Children.map(t,f=>{var p,g,m;return{title:e.jsx("div",{className:"m-[-16px] p-[16px]","data-component-id":(p=f.props)==null?void 0:p.id,children:(g=f.props)==null?void 0:g.title}),dataIndex:(m=f.props)==null?void 0:m.dataIndex,key:f}}),[t]);return e.jsx("div",{className:`w-[100%] ${l?"border-[2px] border-[blue]":"border-[1px] border-[#000]"}`,ref:a,"data-component-id":o,style:s,children:e.jsx(ne,{columns:d,dataSource:[],pagination:!1})})}const ze=({url:o,children:n})=>{const[t,s]=u.useState([]),[l,r]=u.useState(!1),a=async()=>{if(o){r(!0);const{data:i}=await le.get(o);s(i),r(!1)}};u.useEffect(()=>{a()},[]);const c=u.useMemo(()=>T.Children.map(n,i=>{var d,f,p,g,m;return((d=i==null?void 0:i.props)==null?void 0:d.type)==="date"?{title:(f=i.props)==null?void 0:f.title,dataIndex:(p=i.props)==null?void 0:p.dataIndex,render:b=>b?Z(b).format("YYYY-MM-DD"):null}:{title:(g=i.props)==null?void 0:g.title,dataIndex:(m=i.props)==null?void 0:m.dataIndex}}),[n]);return e.jsx(ne,{columns:c,dataSource:t,pagination:!1,rowKey:"id",loading:l})},$e=()=>e.jsx(e.Fragment,{}),Oe=()=>e.jsx(e.Fragment,{});function Ae({id:o,name:n,children:t,onFinish:s}){const[l]=w.useForm(),{canDrop:r,drop:a}=F(["FormItem"],o),c=u.useRef(null),[i,d]=R({type:n,item:{type:n,dragType:"move",id:o}});u.useEffect(()=>{a(c),d(c)},[]);const f=u.useMemo(()=>T.Children.map(t,p=>{var g,m,b,h;return{label:(g=p.props)==null?void 0:g.label,name:(m=p.props)==null?void 0:m.name,type:(b=p.props)==null?void 0:b.type,id:(h=p.props)==null?void 0:h.id}}),[t]);return e.jsx("div",{className:`w-[100%] p-[20px] min-h-[100px] ${r?"border-[2px] border-[blue]":"border-[1px] border-[#000]"}`,ref:c,"data-component-id":o,children:e.jsx(w,{labelCol:{span:6},wrapperCol:{span:18},form:l,onFinish:p=>{s&&s(p)},children:f.map(p=>e.jsx(w.Item,{"data-component-id":p.id,name:p.name,label:p.label,children:e.jsx(N,{style:{pointerEvents:"none"}})},p.name))})})}const Be=({children:o,onFinish:n,...t},s)=>{const[l]=w.useForm();u.useImperativeHandle(s,()=>({submit:()=>{l.submit()}}),[l]);const r=u.useMemo(()=>T.Children.map(o,c=>{var i,d,f,p,g;return{label:(i=c.props)==null?void 0:i.label,name:(d=c.props)==null?void 0:d.name,type:(f=c.props)==null?void 0:f.type,id:(p=c.props)==null?void 0:p.id,rules:(g=c.props)==null?void 0:g.rules}}),[o]);async function a(c){Object.keys(c).forEach(i=>{Z.isDayjs(c[i])&&(c[i]=c[i].format("YYYY-MM-DD"))}),n(c)}return e.jsx(w,{name:"form",labelCol:{span:5},wrapperCol:{span:18},form:l,onFinish:a,...t,children:r.map(c=>e.jsxs(w.Item,{name:c.name,label:c.label,rules:c.rules==="required"?[{required:!0,message:"不能为空"}]:[],children:[c.type==="input"&&e.jsx(N,{}),c.type==="date"&&e.jsx(xe,{})]},c.name))})},Je=u.forwardRef(Be),Ke=()=>e.jsx(e.Fragment,{}),qe=()=>e.jsx(e.Fragment,{}),I=A(o=>({componentConfig:{Container:{name:"Container",defaultProps:{},desc:"容器",dev:Ne,prod:Ie},Button:{name:"Button",defaultProps:{type:"primary",text:"按钮"},setter:[{name:"type",label:"按钮类型",type:"select",options:[{label:"主按钮",value:"primary"},{label:"次按钮",value:"default"}]},{name:"text",label:"文本",type:"input"}],stylesSetter:[{name:"width",label:"宽度",type:"inputNumber"},{name:"height",label:"高度",type:"inputNumber"}],events:[{name:"onClick",label:"点击事件"},{name:"onDoubleClick",label:"双击事件"}],desc:"按钮",dev:ke,prod:Te},Modal:{name:"Modal",defaultProps:{title:"弹窗"},setter:[{name:"title",label:"标题",type:"input"}],stylesSetter:[],events:[{name:"onOk",label:"确认事件"},{name:"onCancel",label:"取消事件"}],methods:[{name:"open",label:"打开弹窗"},{name:"close",label:"关闭弹窗"}],desc:"弹窗",dev:Fe,prod:Re},Page:{name:"Page",defaultProps:{},desc:"页面",dev:Ee,prod:Pe},Table:{name:"Table",defaultProps:{},desc:"表格",setter:[{name:"url",label:"url",type:"input"}],dev:De,prod:ze},TableColumn:{name:"TableColumn",desc:"表格列",defaultProps:{dataIndex:`col_${new Date().getTime()}`,title:"列名"},setter:[{name:"type",label:"类型",type:"select",options:[{label:"文本",value:"text"},{label:"日期",value:"date"}]},{name:"title",label:"标题",type:"input"},{name:"dataIndex",label:"字段",type:"input"}],dev:$e,prod:Oe},Form:{name:"Form",defaultProps:{},desc:"表单",setter:[{name:"title",label:"标题",type:"input"}],events:[{name:"onFinish",label:"提交事件"}],methods:[{name:"submit",label:"提交"}],dev:Ae,prod:Je},FormItem:{name:"FormItem",desc:"表单项",defaultProps:{name:new Date().getTime(),label:"姓名"},dev:Ke,prod:qe,setter:[{name:"type",label:"类型",type:"select",options:[{label:"文本",value:"input"},{label:"日期",value:"date"}]},{name:"label",label:"标题",type:"input"},{name:"name",label:"字段",type:"input"},{name:"rules",label:"校验",type:"select",options:[{label:"必填",value:"required"}]}]}},registerComponent:(n,t)=>o(s=>({...s,componentConfig:{...s.componentConfig,[n]:t}}))}));function Ve({components:o}){const{componentConfig:n}=I(),t=u.useRef({});function s(r){var c,i;const a={};return(i=(c=n[r.name])==null?void 0:c.events)==null||i.forEach(d=>{const f=r.props[d.name];f&&(a[d.name]=(...p)=>{var g;(g=f==null?void 0:f.actions)==null||g.forEach(m=>{var b;if(m.type==="goToLink")window.location.href=m.url;else if(m.type==="showMessage")m.config.type==="success"?P.success(m.config.text):m.config.type==="error"&&P.error(m.config.text);else if(m.type==="customJS")new Function("context","args",m.code)({name:r.name,props:r.props,showMessage(j){P.success(j)}},p);else if(m.type==="componentMethod"){const h=t.current[m.config.componentId];h&&((b=h[m.config.method])==null||b.call(h,...p))}})})}),a}function l(r){return r.map(a=>{const c=n==null?void 0:n[a.name];return c!=null&&c.prod?T.createElement(c.prod,{key:a.id,id:a.id,name:a.name,styles:a.styles,ref:i=>{t.current[a.id]=i},...c.defaultProps,...a.props,...s(a)},l(a.children||[])):null})}return e.jsx("div",{children:l(o)})}const{Header:He,Content:Ue,Sider:Ye}=$;function _e(){const{componentShow:o}=se(),[n,t]=u.useState([]),[s,l]=u.useState(null),[r,a]=u.useState(""),c=ee();u.useEffect(()=>{const d=o.map(f=>({key:`${f.uindex}`,label:`${f.project}`}));t(d),d.length>0&&a(d[0].key)},[o]);const i=d=>{const f=o.find(p=>String(p.uindex)===d.key);if(f){const{uindex:p,project:g,...m}=f;l(m),a(d.key)}};return e.jsxs($,{className:"h-screen",children:[e.jsxs(He,{className:"flex items-center bg-gray-900 text-white shadow-lg",children:[e.jsx("div",{className:"text-xl font-semibold",children:"ChangeLowCode"}),e.jsx(k,{type:"primary",className:"ml-auto",onClick:()=>{c("/edit")},style:{marginLeft:"auto",backgroundColor:"#1890ff",borderColor:"#1890ff"},children:"新添"})]}),e.jsxs($,{children:[e.jsx(Ye,{width:250,className:"bg-gray-100",children:e.jsx(ge,{mode:"inline",selectedKeys:[r],className:"h-full border-r-0",items:n,onClick:i,style:{backgroundColor:"#f5f5f5"}})}),e.jsx($,{className:"p-6",children:e.jsx(Ue,{className:"p-6 bg-white rounded-lg shadow-md",children:s?e.jsx(Ve,{components:[s]}):e.jsx("div",{className:"text-center text-gray-500",children:"请选择一个菜单项查看详细信息。"})})})]})]})}const We=o=>{const{components:n,addComponentDrop:t}=J();u.useEffect(()=>{console.log("Updated components:",n)},[n]),u.useEffect(()=>{(async()=>{const l=await Ge(o);l&&(Object.keys(l).forEach(r=>{t(r);const a={name:r,defaultProps:{},desc:"远程组件",dev:l[r],prod:l[r],setter:[{name:"text",label:"文本",type:"input"}],stylesSetter:[{name:"width",label:"宽度",type:"inputNumber"},{name:"height",label:"高度",type:"inputNumber"}]};I.getState().registerComponent(r,a)}),console.log("components",n))})()},[o,t])};async function Ge(o){try{const n=await fetch(o);if(!n.ok)throw new Error(`Failed to fetch remote component: ${n.statusText}`);const t=await n.text();console.log("Loaded script:",t);const s={exports:{}},l=a=>{if(a==="react")return T;throw new Error(`Module ${a} is not available`)};return new Function("module","exports","require",t)(s,s.exports,l),s.exports}catch(n){return console.error("Failed to load remote component",n),null}}function Qe(){const{mode:o,setMode:n,setCurComponentId:t,components:s}=S(),[l,r]=u.useState(!1),[a,c]=u.useState(""),[i,d]=u.useState("https://cdn.jsdelivr.net/npm/pjw-remote-component@1.0.3/dist/bundle.umd.js"),f=ee(),{addShowMessage:p}=se(),[g,m]=u.useState(!1),[b,h]=u.useState("");We(i);const j=()=>{d(a),r(!1)},x=()=>{const y={...s[0],uindex:s[0].id+Date.now(),project:b};p(y),m(!1),f("/")};return e.jsxs("div",{className:"w-[100%] h-[100%]",children:[e.jsxs("div",{className:"h-[50px] flex justify-between items-center px-[20px]",children:[e.jsx("div",{children:"ChangeLowCode"}),e.jsxs(oe,{children:[e.jsx(k,{type:"primary",onClick:()=>m(!0),children:"保存"}),o==="edit"&&e.jsx(k,{onClick:()=>{n("preview"),t(null)},type:"primary",children:"预览"}),o==="preview"&&e.jsx(k,{onClick:()=>n("edit"),type:"primary",children:"退出预览"}),e.jsx(k,{type:"primary",onClick:()=>r(!0),children:"加载远程组件"})]})]}),e.jsx(O,{title:"输入远程组件 URL",open:l,onOk:j,onCancel:()=>r(!1),children:e.jsx(N,{placeholder:"输入远程组件 URL",value:a,onChange:y=>c(y.target.value)})}),e.jsxs(O,{title:"保存低代码",open:g,onOk:x,onCancel:()=>m(!1),children:[e.jsx(N,{placeholder:"输入名称",value:b,onChange:y=>h(y.target.value)})," "]})]})}function Xe({containerClassName:o,portalWrapperClassName:n,componentId:t,scrollToplength:s,scrollLeftlength:l}){const[r,a]=u.useState({left:0,top:0,width:0,height:0,labelTop:0,labelLeft:0}),{components:c}=S();u.useEffect(()=>{i()},[t,c,s,l]);function i(){if(!t)return;const p=document.querySelector(`.${o}`);if(!p)return;const g=document.querySelector(`[data-component-id="${t}"]`);if(!g)return;const{top:m,left:b,width:h,height:j}=g.getBoundingClientRect(),{top:x,left:y}=p.getBoundingClientRect();let v=m-x+p.scrollTop,C=b-y+h;v<=0&&(v-=-20,C=C+0),a({top:m-x+p.scrollTop-s,left:b-y,width:h,height:j,labelTop:v,labelLeft:C})}const d=u.useMemo(()=>document.querySelector(`.${n}`),[]),f=u.useMemo(()=>M(t,c),[t]);return te.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"absolute",left:r.left,top:r.top,backgroundColor:"rgba(0, 0, 255, 0.05)",border:"1px dashed blue",pointerEvents:"none",width:r.width,height:r.height,zIndex:12,borderRadius:4,boxSizing:"border-box"}}),e.jsx("div",{style:{position:"absolute",left:r.labelLeft,top:r.labelTop,fontSize:"14px",zIndex:13,display:!r.width||r.width<10?"none":"inline",transform:"translate(-100%, -100%)"},children:e.jsx("div",{style:{padding:"0 8px",backgroundColor:"blue",borderRadius:4,color:"#fff",cursor:"pointer",whiteSpace:"nowrap"},children:f==null?void 0:f.desc})})]}),d)}function Ze({containerClassName:o,portalWrapperClassName:n,componentId:t,scrollToplength:s}){const[l,r]=u.useState({left:0,top:0,width:0,height:0,labelTop:0,labelLeft:0}),[a,c]=u.useState(!1),{components:i,curComponentId:d,curComponent:f,deleteComponent:p,setCurComponentId:g}=S();u.useEffect(()=>{const x=()=>{if(!t)return;const C=document.querySelector(`.${o}`);if(!C)return;const E=document.querySelector(`[data-component-id="${t}"]`);if(!E)return;const{top:Y,left:_,width:W,height:re}=E.getBoundingClientRect(),{top:G,left:Q}=C.getBoundingClientRect();let K=Y-G+C.scrollTop,q=_-Q+W;q=q+0,K<=0&&(K-=-20),r({top:Y-G+C.scrollTop-s,left:_-Q,width:W,height:re,labelTop:K,labelLeft:q})},y=()=>{x()};return(()=>{document.querySelector(`.${n}`)&&(c(!0),x())})(),window.addEventListener("resize",y),()=>{window.removeEventListener("resize",y)}},[t,s,o,n]);const m=u.useMemo(()=>M(t,i),[t,i]),b=u.useMemo(()=>{const x=[];let y=f;for(;y!=null&&y.parentId;)y=M(y.parentId,i),x.push(y);return x},[f,i]);function h(){p(d),g(null)}if(!a)return null;const j=document.querySelector(`.${n}`);return te.createPortal(e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"absolute",left:l.left,top:l.top,backgroundColor:"rgba(0, 0, 255, 0.1)",border:"1px dashed blue",pointerEvents:"none",width:l.width,height:l.height,zIndex:12,borderRadius:4,boxSizing:"border-box"}}),e.jsx("div",{style:{position:"absolute",left:l.labelLeft,top:l.labelTop,fontSize:"14px",zIndex:13,display:!l.width||l.width<10?"none":"inline",transform:"translate(-100%, -100%)"},children:e.jsxs(oe,{children:[e.jsx(be,{menu:{items:b.map(x=>({key:x.id,label:x.desc})),onClick:({key:x})=>{g(+x)}},disabled:b.length===0,children:e.jsx("div",{style:{padding:"0 8px",backgroundColor:"blue",borderRadius:4,color:"#fff",cursor:"pointer",whiteSpace:"nowrap"},children:m==null?void 0:m.desc})}),d!==1&&e.jsx("div",{style:{padding:"0 8px",backgroundColor:"blue"},children:e.jsx(ye,{title:"确认删除？",okText:"确认",cancelText:"取消",onConfirm:h,children:e.jsx(L,{style:{color:"#fff"}})})})]})})]}),j)}function et(){const{components:o,curComponentId:n,setCurComponentId:t}=S(),{componentConfig:s}=I(),l=u.useRef(null),[r,a]=u.useState(0),[c,i]=u.useState(0);function d(h){return h.map(j=>{const x=s==null?void 0:s[j.name];return x!=null&&x.dev?T.createElement(x.dev,{key:j.id,id:j.id,name:j.name,styles:j.styles,...x.defaultProps,...j.props},d(j.children||[])):null})}const[f,p]=u.useState(),g=h=>{var x;const j=h.nativeEvent.composedPath();for(let y=0;y<j.length;y+=1){const C=(x=j[y].dataset)==null?void 0:x.componentId;if(C){p(+C);return}}},m=h=>{var x;const j=h.nativeEvent.composedPath();for(let y=0;y<j.length;y+=1){const C=(x=j[y].dataset)==null?void 0:x.componentId;if(C){t(+C);return}}},b=()=>{if(l.current){const{scrollTop:h,scrollLeft:j}=l.current;a(h),i(j)}};return u.useEffect(()=>{const h=l.current;return h&&h.addEventListener("scroll",b),()=>{h&&h.removeEventListener("scroll",b)}},[]),e.jsxs("div",{ref:l,className:"h-[100%] edit-area overflow-auto",style:{boxSizing:"border-box",paddingRight:"17px",paddingBottom:"17px"},onMouseOver:g,onMouseLeave:()=>p(void 0),onClick:m,children:[d(o),f&&f!==n&&e.jsx(Xe,{portalWrapperClassName:"portal-wrapper",containerClassName:"edit-area",componentId:f,scrollToplength:r,scrollLeftlength:c}),n&&e.jsx(Ze,{portalWrapperClassName:"portal-wrapper",containerClassName:"edit-area",componentId:n,scrollToplength:r}),e.jsx("div",{className:"portal-wrapper"})]})}function tt(){var c,i;const[o]=w.useForm(),{curComponentId:n,curComponent:t,updateComponentProps:s}=S(),{componentConfig:l}=I();if(u.useEffect(()=>{const d=o.getFieldsValue();o.setFieldsValue({...d,...t==null?void 0:t.props})},[t]),!n||!t)return null;function r(d){const{type:f,options:p}=d;if(f==="select")return e.jsx(B,{options:p});if(f==="input")return e.jsx(N,{})}function a(d){n&&s(n,d)}return e.jsxs(w,{form:o,onValuesChange:a,labelCol:{span:8},wrapperCol:{span:14},children:[e.jsx(w.Item,{label:"组件id",children:e.jsx(N,{value:t.id,disabled:!0})}),e.jsx(w.Item,{label:"组件名称",children:e.jsx(N,{value:t.name,disabled:!0})}),e.jsx(w.Item,{label:"组件描述",children:e.jsx(N,{value:t.desc,disabled:!0})}),(i=(c=l[t.name])==null?void 0:c.setter)==null?void 0:i.map(d=>e.jsx(w.Item,{name:d.name,label:d.label,children:r(d)},d.name))]})}function nt(o){const{defaultValue:n,value:t,onChange:s}=o,{curComponentId:l}=S(),[r,a]=u.useState(n);u.useEffect(()=>{a(t)},[t]);function c(i){l&&(a(i),s==null||s({type:"goToLink",url:i}))}return e.jsx("div",{className:"mt-[40px]",children:e.jsxs("div",{className:"flex items-center gap-[10px]",children:[e.jsx("div",{children:"跳转链接"}),e.jsx("div",{children:e.jsx(je,{style:{height:200,width:500,border:"1px solid #000"},onChange:i=>{c(i.target.value)},value:r||""})})]})})}function ot(o){const{value:n,defaultValue:t,onChange:s}=o,{curComponentId:l}=S(),[r,a]=u.useState((t==null?void 0:t.type)||"success"),[c,i]=u.useState((t==null?void 0:t.text)||"");u.useEffect(()=>{n&&(a(n.type),i(n.text))},[n]);function d(p){l&&(a(p),s==null||s({type:"showMessage",config:{type:p,text:c}}))}function f(p){l&&(i(p),s==null||s({type:"showMessage",config:{type:r,text:p}}))}return e.jsxs("div",{className:"mt-[30px]",children:[e.jsxs("div",{className:"flex items-center gap-[20px]",children:[e.jsx("div",{children:"类型："}),e.jsx("div",{children:e.jsx(B,{style:{width:500,height:50},options:[{label:"成功",value:"success"},{label:"失败",value:"error"}],onChange:p=>{d(p)},value:r})})]}),e.jsxs("div",{className:"flex items-center gap-[20px] mt-[50px]",children:[e.jsx("div",{children:"文本："}),e.jsx("div",{children:e.jsx(N,{style:{width:500,height:50},onChange:p=>{f(p.target.value)},value:c})})]})]})}function st(o){const{value:n,defaultValue:t,onChange:s}=o,{curComponentId:l}=S(),[r,a]=u.useState(t);u.useEffect(()=>{a(n)},[n]);function c(d){l&&(a(d),s==null||s({type:"customJS",code:d}))}const i=(d,f)=>{d.focus(),d.addCommand(f.KeyMod.CtrlCmd|f.KeyCode.KeyJ,()=>{var p;(p=d.getAction("editor.action.formatDocument"))==null||p.run()})};return e.jsx("div",{className:"mt-[40px]",children:e.jsxs("div",{className:"flex items-start gap-[20px]",children:[e.jsx("div",{children:"自定义 JS"}),e.jsx("div",{children:e.jsx(H,{width:"600px",height:"400px",path:"action.js",language:"javascript",onMount:i,onChange:c,value:r,options:{fontSize:14,scrollBeyondLastLine:!1,minimap:{enabled:!1},scrollbar:{verticalScrollbarSize:6,horizontalScrollbarSize:6}}})})]})})}function rt(o){var b;const{value:n,onChange:t}=o,{components:s,curComponentId:l}=S(),{componentConfig:r}=I(),[a,c]=u.useState(),[i,d]=u.useState(),[f,p]=u.useState();u.useEffect(()=>{n&&(d(n.componentId),p(n.method),c(M(n.componentId,s)))},[n]);function g(h){l&&(d(h),c(M(h,s)))}function m(h){!l||!a||(p(h),t==null||t({type:"componentMethod",config:{componentId:a==null?void 0:a.id,method:h}}))}return e.jsxs("div",{className:"mt-[40px]",children:[e.jsxs("div",{className:"flex items-center gap-[10px]",children:[e.jsx("div",{children:"组件："}),e.jsx("div",{children:e.jsx(ve,{style:{width:500,height:50},treeData:s,fieldNames:{label:"name",value:"id"},value:i,onChange:h=>{g(h)}})})]}),r[(a==null?void 0:a.name)||""]&&e.jsxs("div",{className:"flex items-center gap-[10px] mt-[20px]",children:[e.jsx("div",{children:"方法："}),e.jsx("div",{children:e.jsx(B,{style:{width:500,height:50},options:(b=r[(a==null?void 0:a.name)||""].methods)==null?void 0:b.map(h=>({label:h.label,value:h.name})),value:f,onChange:h=>{m(h)}})})]})]})}function at(o){const{visible:n,action:t,handleOk:s,handleCancel:l}=o,r={goToLink:"访问链接",showMessage:"消息提示",customJS:"自定义 JS",componentMethod:"组件方法"},[a,c]=u.useState("访问链接"),[i,d]=u.useState();return u.useEffect(()=>{t!=null&&t.type&&c(r[t.type])},[t]),e.jsx(O,{title:"事件动作配置",width:800,open:n,okText:"确认",cancelText:"取消",onOk:()=>s(i),onCancel:l,children:e.jsxs("div",{className:"h-[500px]",children:[e.jsx(U,{value:a,onChange:c,block:!0,options:["访问链接","消息提示","组件方法","自定义 JS"]}),a==="访问链接"&&e.jsx(nt,{value:(t==null?void 0:t.type)==="goToLink"?t.url:"",onChange:f=>{d(f)}},"goToLink"),a==="消息提示"&&e.jsx(ot,{value:(t==null?void 0:t.type)==="showMessage"?t.config:void 0,onChange:f=>{d(f)}},"showMessage"),a==="组件方法"&&e.jsx(rt,{value:(t==null?void 0:t.type)==="componentMethod"?t.config:void 0,onChange:f=>{d(f)}},"showMessage"),a==="自定义 JS"&&e.jsx(st,{value:(t==null?void 0:t.type)==="customJS"?t.code:"",onChange:f=>{d(f)}},"customJS")]})})}function lt(){var j;const{components:o,curComponent:n,updateComponentProps:t}=S(),{componentConfig:s}=I(),[l,r]=u.useState(!1),[a,c]=u.useState(),[i,d]=u.useState(),[f,p]=u.useState();if(!n)return null;function g(x,y){var C;if(!n)return;const v=(C=n.props[x.name])==null?void 0:C.actions;v.splice(y,1),t(n.id,{[x.name]:{actions:v}})}function m(x,y){n&&(d(x),p(y),r(!0))}const b=(s[n.name].events||[]).map(x=>{var y;return{key:x.name,label:e.jsxs("div",{className:"flex justify-between leading-[30px]",children:[x.label,e.jsx(k,{type:"primary",onClick:v=>{v.stopPropagation(),c(x),r(!0)},children:"添加动作"})]}),children:e.jsx("div",{children:(((y=n.props[x.name])==null?void 0:y.actions)||[]).map((v,C)=>{var E;return e.jsxs("div",{children:[v.type==="goToLink"?e.jsxs("div",{className:"border border-[#aaa] m-[10px] p-[10px] relative",children:[e.jsx("div",{className:"text-[blue]",children:"跳转链接"}),e.jsx("div",{children:v.url}),e.jsx("div",{style:{position:"absolute",top:10,right:30,cursor:"pointer"},onClick:()=>m(v,C),children:e.jsx(D,{})}),e.jsx("div",{style:{position:"absolute",top:10,right:10,cursor:"pointer"},onClick:()=>g(x,C),children:e.jsx(L,{})})]},"goToLink"):null,v.type==="showMessage"?e.jsxs("div",{className:"border border-[#aaa] m-[10px] p-[10px] relative",children:[e.jsx("div",{className:"text-[blue]",children:"消息弹窗"}),e.jsx("div",{children:v.config.type}),e.jsx("div",{children:v.config.text}),e.jsx("div",{style:{position:"absolute",top:10,right:30,cursor:"pointer"},onClick:()=>m(v,C),children:e.jsx(D,{})}),e.jsx("div",{style:{position:"absolute",top:10,right:10,cursor:"pointer"},onClick:()=>g(x,C),children:e.jsx(L,{})})]},"showMessage"):null,v.type==="customJS"?e.jsxs("div",{className:"border border-[#aaa] m-[10px] p-[10px] relative",children:[e.jsx("div",{className:"text-[blue]",children:"自定义 JS"}),e.jsx("div",{style:{position:"absolute",top:10,right:30,cursor:"pointer"},onClick:()=>m(v,C),children:e.jsx(D,{})}),e.jsx("div",{style:{position:"absolute",top:10,right:10,cursor:"pointer"},onClick:()=>g(x,C),children:e.jsx(L,{})})]},"customJS"):null,v.type==="componentMethod"?e.jsxs("div",{className:"border border-[#aaa] m-[10px] p-[10px] relative",children:[e.jsx("div",{className:"text-[blue]",children:"组件方法"}),e.jsx("div",{children:(E=M(v.config.componentId,o))==null?void 0:E.desc}),e.jsx("div",{children:v.config.componentId}),e.jsx("div",{children:v.config.method}),e.jsx("div",{style:{position:"absolute",top:10,right:30,cursor:"pointer"},onClick:()=>m(v,C),children:e.jsx(D,{})}),e.jsx("div",{style:{position:"absolute",top:10,right:10,cursor:"pointer"},onClick:()=>g(x,C),children:e.jsx(L,{})})]},"componentMethod"):null]})})})}});function h(x){var y,v;!x||!a||!n||(i?t(n.id,{[a.name]:{actions:(y=n.props[a.name])==null?void 0:y.actions.map((C,E)=>E===f?x:C)}}):t(n.id,{[a.name]:{actions:[...((v=n.props[a.name])==null?void 0:v.actions)||[],x]}}),d(void 0),r(!1))}return e.jsxs("div",{className:"px-[10px]",children:[e.jsx(Ce,{className:"mb-[10px]",items:b,defaultActiveKey:(j=s[n.name].events)==null?void 0:j.map(x=>x.name)}),e.jsx(at,{visible:l,handleOk:h,action:i,handleCancel:()=>{d(void 0),r(!1)}})]})}function ct(o){const{value:n,onChange:t,options:s}=o,l=(r,a)=>{r.addCommand(a.KeyMod.CtrlCmd|a.KeyCode.KeyJ,()=>{var c;(c=r.getAction("editor.action.formatDocument"))==null||c.run()})};return e.jsx(H,{height:"100%",path:"component.css",language:"css",onMount:l,onChange:t,value:n,options:{fontSize:14,scrollBeyondLastLine:!1,minimap:{enabled:!1},scrollbar:{verticalScrollbarSize:6,horizontalScrollbarSize:6},...s}})}function it(){var p,g;const[o]=w.useForm(),{curComponentId:n,curComponent:t,updateComponentStyles:s}=S(),{componentConfig:l}=I(),[r,a]=u.useState(`.comp{

}`);u.useEffect(()=>{o.resetFields();const m=o.getFieldsValue();o.setFieldsValue({...m,...t==null?void 0:t.styles}),a(c(t==null?void 0:t.styles))},[t]);function c(m){let b=`.comp {
`;for(const h in m){let j=m[h];j&&(["width","height"].includes(h)&&!j.toString().endsWith("px")&&(j+="px"),b+=`	${h}: ${j};
`)}return b+="}",b}if(!n||!t)return null;function i(m){const{type:b,options:h}=m;if(b==="select")return e.jsx(B,{options:h});if(b==="input")return e.jsx(N,{});if(b==="inputNumber")return e.jsx(Se,{})}function d(m){n&&s(n,m)}const f=he(m=>{a(m);const b={};try{const h=m.replace(/\/\*.*\*\//,"").replace(/(\.?[^{]+{)/,"").replace("}","");ce(h,(j,x)=>{b[j.replace(/-\w/,y=>y.toUpperCase().replace("-",""))]=x}),s(n,{...o.getFieldsValue(),...b},!0)}catch(h){console.log(h)}},500);return e.jsxs(w,{form:o,onValuesChange:d,labelCol:{span:8},wrapperCol:{span:14},children:[(g=(p=l[t.name])==null?void 0:p.stylesSetter)==null?void 0:g.map(m=>e.jsx(w.Item,{name:m.name,label:m.label,children:i(m)},m.name)),e.jsx("div",{className:"h-[200px] border-[1px] border-[#ccc] z-10",children:e.jsx(ct,{value:r,onChange:f})})]})}function dt(){const{curComponentId:o}=S(),[n,t]=u.useState("属性");return o?e.jsxs("div",{children:[e.jsx(U,{value:n,onChange:t,block:!0,options:["属性","样式","事件"]}),e.jsxs("div",{className:"pt-[20px]",children:[n==="属性"&&e.jsx(tt,{}),n==="样式"&&e.jsx(it,{}),n==="事件"&&e.jsx(lt,{})]})]}):null}function X(o){const{name:n,desc:t}=o,[s,l]=R({type:n,item:{type:n}});return console.log(s),e.jsxs("div",{ref:l,className:`\r
                border\r
                border-gray-300\r
                w-24       /* 较小的固定宽度 */\r
                h-14       /* 较小的固定高度 */\r
                p-2        /* 适中的内边距 */\r
                m-1        /* 较小的外边距 */\r
                cursor-move\r
                inline-flex /* 使用 inline-flex 布局 */\r
                flex-col\r
                justify-center /* 垂直居中 */\r
                items-center   /* 水平居中 */\r
                bg-white\r
                rounded-md\r
                shadow-sm\r
                transition-transform\r
                transform-gpu\r
                hover:shadow-md\r
                hover:scale-105\r
                hover:bg-gray-100\r
                text-center    /* 文本居中 */\r
            `,children:[e.jsx("div",{className:"text-xs font-medium text-gray-800",children:n}),e.jsx("div",{className:"text-xxs text-gray-500 mt-1",children:t})]})}function pt(){const{componentConfig:o}=I(),n=u.useMemo(()=>Object.values(o).filter(t=>t.name!=="Page"),[o]);return e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"m-2",children:"基础组件"}),e.jsx("div",{className:"m-2 overflow-auto",children:n.filter(t=>t.desc!=="远程组件").map((t,s)=>e.jsx(X,{name:t.name,desc:t.desc},t.name+s))}),e.jsx("span",{className:"m-2",children:"远程组件"}),e.jsx("div",{className:"m-2 overflow-auto",children:n.filter(t=>t.desc==="远程组件").map((t,s)=>e.jsx(X,{name:t.name,desc:t.desc},t.name+s))})]})}function ut(){const{components:o,setCurComponentId:n}=S();return e.jsx(we,{fieldNames:{title:"desc",key:"id"},treeData:o,showLine:!0,defaultExpandAll:!0,onSelect:([t])=>{n(t)}})}function mt(){const{components:o}=S(),n=(t,s)=>{t.addCommand(s.KeyMod.CtrlCmd|s.KeyCode.KeyJ,()=>{var l;(l=t.getAction("editor.action.formatDocument"))==null||l.run()})};return e.jsx(H,{height:"100%",path:"components.json",language:"json",onMount:n,value:JSON.stringify(o,null,2),options:{fontSize:14,scrollBeyondLastLine:!1,minimap:{enabled:!1},scrollbar:{verticalScrollbarSize:6,horizontalScrollbarSize:6}}})}function ft(){const[o,n]=u.useState("物料");return e.jsxs("div",{children:[e.jsx(U,{value:o,onChange:n,block:!0,options:["物料","大纲","源码"]}),e.jsxs("div",{className:"pt-[20px] h-[calc(100vh-60px-30px-20px)]",children:[o==="物料"&&e.jsx(pt,{}),o==="大纲"&&e.jsx(ut,{}),o==="源码"&&e.jsx(mt,{})]})]})}function ht(){const{components:o}=S(),{componentConfig:n}=I(),t=u.useRef({});function s(r){var c;const a={};return(c=n[r.name].events)==null||c.forEach(i=>{const d=r.props[i.name];d&&(a[i.name]=(...f)=>{var p;(p=d==null?void 0:d.actions)==null||p.forEach(g=>{var m;if(g.type==="goToLink")window.location.href=g.url;else if(g.type==="showMessage")g.config.type==="success"?P.success(g.config.text):g.config.type==="error"&&P.error(g.config.text);else if(g.type==="customJS")new Function("context","args",g.code)({name:r.name,props:r.props,showMessage(h){P.success(h)}},f);else if(g.type==="componentMethod"){const b=t.current[g.config.componentId];b&&((m=b[g.config.method])==null||m.call(b,...f))}})})}),a}function l(r){return r.map(a=>{const c=n==null?void 0:n[a.name];return c!=null&&c.prod?T.createElement(c.prod,{key:a.id,id:a.id,name:a.name,styles:a.styles,ref:i=>{t.current[a.id]=i},...c.defaultProps,...a.props,...s(a)},l(a.children||[])):null})}return e.jsx("div",{children:l(o)})}function xt(){const{mode:o}=S();return e.jsxs("div",{className:"h-[100vh] flex flex-col",children:[e.jsx("div",{className:"h-[60px] flex items-center border-b-[1px] border-[#000]",children:e.jsx(Qe,{})}),o==="edit"?e.jsxs(z,{children:[e.jsx(z.Pane,{preferredSize:240,maxSize:400,minSize:200,children:e.jsx(ft,{})}),e.jsx(z.Pane,{children:e.jsx(et,{})}),e.jsx(z.Pane,{preferredSize:300,maxSize:500,minSize:300,children:e.jsx(dt,{})})]}):e.jsx(ht,{})]})}const gt=ie([{path:"/",Component:_e},{path:"/edit",Component:xt}]);function bt(){return e.jsx(de,{router:gt})}pe.createRoot(document.getElementById("root")).render(e.jsx(ue,{backend:me,children:e.jsx(bt,{})}));
